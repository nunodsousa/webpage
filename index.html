<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nuno · Analytics Playground</title>

  <!-- Plotly: explicit v2.x -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

  <style>
    :root{
      --bg:#0f172a; --panel:#0b1226; --muted:#94a3b8; --text:#e5e7eb;
      --brand:#06b6d4; --accent:#38bdf8; --card:#0b1226; --shadow: 0 10px 30px rgba(2,8,23,.28);
      --radius: 18px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 10% -10%, rgba(56,189,248,.10), transparent 50%),
                  radial-gradient(1200px 600px at 110% 20%, rgba(34,211,238,.10), transparent 50%),
                  var(--bg);
      color:var(--text); display:flex; min-height:100vh;
    }

    /* Sidebar */
    .sidebar{width:260px; background: linear-gradient(180deg, rgba(2,8,23,.7), rgba(2,8,23,.25)), var(--panel);
      border-right:1px solid rgba(148,163,184,.12); padding:20px 18px; position:sticky; top:0; height:100vh;}
    .logo{display:flex; align-items:center; gap:12px; margin-bottom:14px;}
    .logo svg{width:34px;height:34px; filter:drop-shadow(0 4px 10px rgba(34,211,238,.35))}
    .logo h1{font-size:18px; margin:0; letter-spacing:.3px}
    .subtle{color:var(--muted); font-size:13px; margin:0 0 22px}
    .side-group{margin-top:18px}
    .side-title{font-size:12px; text-transform:uppercase; letter-spacing:.16em; color:#86a2c2; margin:10px 10px}
    .side-link{display:flex; align-items:center; gap:10px; padding:10px 12px; margin:6px 6px; border-radius:12px;
      color:var(--text); text-decoration:none; border:1px solid rgba(148,163,184,.10);
      background:linear-gradient(180deg, rgba(148,163,184,.06), rgba(148,163,184,.02));
      transition:transform .08s ease, border-color .2s ease, background .2s ease;}
    .side-link:hover{transform:translateY(-1px); border-color:rgba(34,211,238,.35)}
    .pill{margin-left:auto; font-size:11px; color:#9bdff3; background:rgba(34,211,238,.15); padding:2px 8px; border-radius:999px; border:1px solid rgba(34,211,238,.25)}

    /* Main */
    .container{flex:1; display:flex; flex-direction:column}
    .topbar{position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(2,8,23,.65), rgba(2,8,23,.35));
      border-bottom:1px solid rgba(148,163,184,.12);}
    .top-wrap{display:flex; align-items:center; justify-content:space-between; padding:12px 20px}
    .menu{display:flex; gap:10px; padding:8px; border-radius:999px; background:rgba(148,163,184,.10); border:1px solid rgba(148,163,184,.16)}
    .menu button{background:transparent; border:0; color:var(--text); padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; font-size:14px;}
    .menu button.active{background:linear-gradient(180deg, rgba(34,211,238,.22), rgba(34,211,238,.1)); box-shadow: inset 0 0 0 1px rgba(34,211,238,.35)}

    .content{padding:22px; max-width:1200px; margin:0 auto; width:100%}
    .card{background: linear-gradient(180deg, rgba(148,163,184,.07), rgba(148,163,184,.03));
      border:1px solid rgba(148,163,184,.12); box-shadow: var(--shadow); border-radius: var(--radius); padding:20px; margin-bottom:20px;}
    h2{margin:0 0 8px; font-size:20px}
    p.lead{margin:0 0 12px; color:#c7d2fe}

    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    .plot{min-height:420px; border-radius:14px; background:var(--card); border:1px solid rgba(148,163,184,.12); padding:8px}

    /* Mandelbrot */
    .mandel-wrap{display:flex; flex-direction:column; gap:10px}
    .mandel-controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .mandel-controls label{font-size:12px; color:var(--muted)}
    .mandel-controls input{background:rgba(2,8,23,.4); color:var(--text); border:1px solid rgba(148,163,184,.25); border-radius:10px; padding:6px 8px; width:110px}
    .mandel-controls button{background:linear-gradient(180deg, rgba(34,211,238,.28), rgba(34,211,238,.12));
      border:1px solid rgba(34,211,238,.45); color:var(--text); font-weight:700; padding:8px 12px; border-radius:12px; cursor:pointer;}
    .mandel-json{display:flex; gap:10px; margin-top:6px; align-items:center; flex-wrap:wrap}
    .mandel-json textarea{width:100%; min-height:60px; background:rgba(2,8,23,.4); color:var(--text); border:1px solid rgba(148,163,184,.25); border-radius:10px; padding:8px}
    canvas{width:100%; height:420px; border-radius:14px; background:var(--card); border:1px solid rgba(148,163,184,.12)}
    .tab{display:block} /* single tab now */

    @media (max-width: 1040px){ .grid{grid-template-columns:1fr} .sidebar{display:none} .content{padding:18px} }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
          <stop stop-color="#22d3ee"/><stop offset="1" stop-color="#38bdf8"/></linearGradient></defs>
        <circle cx="32" cy="32" r="28" stroke="url(#g)" stroke-width="3"/>
        <path d="M18 36c10-2 18-10 28-8M20 44c8-4 16-4 24-2" stroke="url(#g)" stroke-width="3" stroke-linecap="round"/>
      </svg>
      <h1>Analytics Playground</h1>
    </div>
    <p class="subtle">Interactive demos: Plotly & Mandelbrot</p>

    <div class="side-group">
      <div class="side-title">Sections</div>
      <a href="#" class="side-link" onclick="scrollToId('js-plots')">JavaScript Plots <span class="pill">2D + 3D</span></a>
      <a href="#" class="side-link" onclick="scrollToId('mandelbrot')">Mandelbrot <span class="pill">GPU-free</span></a>
    </div>
  </aside>

  <!-- Main -->
  <div class="container">
    <header class="topbar">
      <div class="top-wrap">
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-weight:800;letter-spacing:.12em;color:#9bdff3">NUNO • DEMOS</span>
        </div>
        <nav class="menu" aria-label="Subpages">
          <button class="active" disabled>JavaScript</button>
        </nav>
      </div>
    </header>

    <main class="content">
      <!-- JS Plots -->
      <section id="js-plots" class="tab" role="tabpanel">
        <div class="card">
          <h2>JavaScript Examples (Plotly)</h2>
          <p class="lead">Interactive 2D and 3D plots rendered in the browser.</p>
        </div>

        <div class="grid">
          <div class="card">
            <h3 style="margin:0 0 10px">2D Line Chart: sin(x), cos(x)</h3>
            <div id="js-plot-2d" class="plot" aria-label="2D Plot"></div>
          </div>

          <div class="card">
            <h3 style="margin:0 0 10px">3D Surface: z = sin(x)·cos(y)</h3>
            <div id="js-plot-3d" class="plot" aria-label="3D Plot"></div>
          </div>
        </div>
      </section>

      <!-- Mandelbrot -->
      <section id="mandelbrot" class="tab" role="tabpanel" style="margin-top:18px">
        <div class="card">
          <h2>Mandelbrot Set (JavaScript)</h2>
          <p class="lead">Scroll to zoom, drag to pan. Set parameters manually, via JSON, URL, or API.</p>
          <div class="mandel-wrap">
            <div class="mandel-controls">
              <label>Center X <input id="cx" type="number" step="0.001" value="-0.5" /></label>
              <label>Center Y <input id="cy" type="number" step="0.001" value="0.0" /></label>
              <label>Scale <input id="scale" type="number" step="0.0001" value="0.004" /></label>
              <label>Iterations <input id="iter" type="number" min="10" max="3000" value="500" /></label>
              <button onclick="resetMandel()">Reset</button>
              <button onclick="renderMandel()">Render</button>
            </div>
            <div class="mandel-json">
              <textarea id="params-json" placeholder='{"cx":-0.75,"cy":0.1,"scale":0.003,"maxIter":800}'></textarea>
              <button onclick="applyJsonParams()">Apply JSON</button>
              <button onclick="copyCurrentParams()">Copy Current Params</button>
            </div>
            <canvas id="mandel"></canvas>
            <div class="subtle">Tip: Use your mouse wheel to zoom at the cursor. Drag to pan.</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- JavaScript logic -->
  <script>
    function scrollToId(id){
      const el = document.getElementById(id);
      if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
    }

    // Plotly 2D: sin & cos
    function draw2D(){
      const N = 400, xs = [], ys = [], yc = [];
      for(let i=0;i<N;i++){
        const x = i*(2*Math.PI)/(N-1);
        xs.push(x); ys.push(Math.sin(x)); yc.push(Math.cos(x));
      }
      const data = [
        {x:xs, y:ys, mode:'lines', name:'sin(x)'},
        {x:xs, y:yc, mode:'lines', name:'cos(x)'}
      ];
      const layout = { title:'Sine & Cosine (Plotly 2D)', xaxis:{title:'x'}, yaxis:{title:'y'}, margin:{t:48, r:12, b:48, l:48} };
      Plotly.newPlot('js-plot-2d', data, layout, {responsive:true});
    }

    // Plotly 3D: z = sin(x)·cos(y)
    function draw3D(){
      const x = [], y = [];
      for(let i=0;i<=60;i++){ x.push(-3 + 6*i/60); y.push(-3 + 6*i/60); }
      const z = [];
      for(let i=0;i<x.length;i++){
        const row = [];
        for(let j=0; j<y.length; j++){
          const xx = x[i], yy = y[j];
          row.push(Math.sin(xx) * Math.cos(yy));
        }
        z.push(row);
      }
      const data = [{ type:'surface', x:x, y:y, z:z, contours:{ z:{show:true, usecolormap:true, highlightcolor:'white', project:{z:true}}}}];
      const layout = { title:'Surface z = sin(x)·cos(y) (Plotly 3D)', scene:{ xaxis:{title:'x'}, yaxis:{title:'y'}, zaxis:{title:'z'} }, margin:{l:0,r:0,b:0,t:48} };
      Plotly.newPlot('js-plot-3d', data, layout, {responsive:true});
    }

    // -------- Mandelbrot (Canvas) --------
    const mandelCanvas = document.getElementById('mandel');
    const ctx = mandelCanvas.getContext('2d', { willReadFrequently: true });

    // Resize canvas to container CSS size
    function fitCanvas() {
      const rect = mandelCanvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      mandelCanvas.width  = Math.max(1, Math.floor(rect.width * dpr));
      mandelCanvas.height = Math.max(1, Math.floor(rect.height * dpr));
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // align drawing with CSS pixels
    }

    // State
    let state = {
      cx: -0.5,
      cy:  0.0,
      scale: 0.004,   // complex units per CSS pixel
      maxIter: 500,
      isPanning: false,
      panStart: {x:0,y:0},
      centerStart: {cx: -0.5, cy: 0.0}
    };

    // Public API: programmatic generation
    function generateMandelbrot(newParams = {}){
      // Allow both iter and maxIter keys
      if ('iter' in newParams && !('maxIter' in newParams)) {
        newParams.maxIter = newParams.iter;
      }
      Object.assign(state, newParams);
      stateToUi();
      renderMandelCore();
    }
    // Expose API globally
    window.generateMandelbrot = generateMandelbrot;

    function uiToState(){
      state.cx = parseFloat(document.getElementById('cx').value);
      state.cy = parseFloat(document.getElementById('cy').value);
      state.scale = parseFloat(document.getElementById('scale').value);
      state.maxIter = parseInt(document.getElementById('iter').value, 10);
    }
    function stateToUi(){
      document.getElementById('cx').value = isFinite(state.cx) ? state.cx.toFixed(6) : "-0.500000";
      document.getElementById('cy').value = isFinite(state.cy) ? state.cy.toFixed(6) : "0.000000";
      document.getElementById('scale').value = isFinite(state.scale) ? state.scale.toFixed(6) : "0.004000";
      document.getElementById('iter').value = isFinite(state.maxIter) ? state.maxIter : 500;
    }

    function resetMandel(){
      state = { cx:-0.5, cy:0.0, scale:0.004, maxIter:500, isPanning:false, panStart:{x:0,y:0}, centerStart:{cx:-0.5, cy:0.0} };
      stateToUi();
      renderMandelCore();
    }

    function colorMap(t){
      // t in [0,1] (smooth iteration ratio). Convert HSV->RGB quickly.
      const h = 360 * t, s = 1, v = t < 1 ? 1 : 0; // black for interior
      const c = v * s;
      const x = c * (1 - Math.abs((h/60)%2 - 1));
      const m = v - c;
      let r=0,g=0,b=0;
      if(h < 60)       { r=c; g=x; b=0; }
      else if(h <120 ) { r=x; g=c; b=0; }
      else if(h <180 ) { r=0; g=c; b=x; }
      else if(h <240 ) { r=0; g=x; b=c; }
      else if(h <300 ) { r=x; g=0; b=c; }
      else             { r=c; g=0; b=x; }
      return [Math.round((r+m)*255), Math.round((g+m)*255), Math.round((b+m)*255)];
    }

    function renderMandel(){
      // Manual trigger from buttons/inputs
      uiToState();
      renderMandelCore();
    }

    function renderMandelCore(){
      fitCanvas();
      const w = mandelCanvas.width;
      const h = mandelCanvas.height;
      const img = ctx.createImageData(w, h);

      // scale is per CSS pixel; convert to device pixel (since width/height are device px)
      const dpr = window.devicePixelRatio || 1;
      const scalePerDevPx = state.scale / dpr;

      const cx = state.cx, cy = state.cy;
      const maxIter = state.maxIter;
      const escape2 = 4;

      let ptr = 0;
      for(let py=0; py<h; py++){
        const y0 = cy + (py - h/2) * scalePerDevPx;
        for(let px=0; px<w; px++){
          const x0 = cx + (px - w/2) * scalePerDevPx;
          let x = 0, y = 0, iter = 0;
          let x2 = 0, y2 = 0;
          while (x2 + y2 <= escape2 && iter < maxIter){
            y = 2*x*y + y0;
            x = x2 - y2 + x0;
            x2 = x*x; y2 = y*y;
            iter++;
          }
          let r,g,b;
          if (iter >= maxIter){
            r=g=b=0; // interior black
          } else {
            // Smooth iteration count
            const zn = Math.sqrt(x2 + y2);
            const nu = Math.log(Math.log(zn)/Math.log(2)) / Math.log(2);
            const smooth = (iter + 1 - nu) / maxIter;
            [r,g,b] = colorMap(Math.max(0, Math.min(1, smooth)));
          }
          img.data[ptr++] = r;
          img.data[ptr++] = g;
          img.data[ptr++] = b;
          img.data[ptr++] = 255;
        }
      }
      ctx.putImageData(img, 0, 0);
    }

    // JSON controls
    function applyJsonParams(){
      const t = document.getElementById('params-json').value.trim();
      if(!t) return;
      try{
        const obj = JSON.parse(t);
        generateMandelbrot(obj);
      }catch(e){
        alert("Invalid JSON: " + e.message);
      }
    }
    function copyCurrentParams(){
      const obj = { cx: state.cx, cy: state.cy, scale: state.scale, maxIter: state.maxIter };
      const text = JSON.stringify(obj);
      navigator.clipboard?.writeText(text);
      document.getElementById('params-json').value = text;
    }

    // URL query support: ?cx=...&cy=...&scale=...&iter=... (iter alias for maxIter)
    function applyUrlParams(){
      const q = new URLSearchParams(window.location.search);
      const p = {};
      if(q.has('cx')) p.cx = parseFloat(q.get('cx'));
      if(q.has('cy')) p.cy = parseFloat(q.get('cy'));
      if(q.has('scale')) p.scale = parseFloat(q.get('scale'));
      if(q.has('iter')) p.maxIter = parseInt(q.get('iter'), 10);
      if(Object.keys(p).length) generateMandelbrot(p);
    }

    // Zoom with wheel (zoom at cursor)
    mandelCanvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      const rect = mandelCanvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      const mx = (e.clientX - rect.left) * dpr;
      const my = (e.clientY - rect.top) * dpr;

      // Convert to complex coords before zoom
      const scalePerDevPx = state.scale / dpr;
      const x0 = state.cx + (mx - mandelCanvas.width/2) * scalePerDevPx;
      const y0 = state.cy + (my - mandelCanvas.height/2) * scalePerDevPx;

      const zoom = e.deltaY < 0 ? 0.8 : 1.25; // in/out
      state.scale *= zoom;

      // Keep cursor fixed by recentering
      const scalePerDevPxNew = state.scale / dpr;
      state.cx = x0 - (mx - mandelCanvas.width/2) * scalePerDevPxNew;
      state.cy = y0 - (my - mandelCanvas.height/2) * scalePerDevPxNew;

      stateToUi();
      renderMandelCore();
    }, { passive:false });

    // Pan with drag
    mandelCanvas.addEventListener('mousedown', (e) => {
      state.isPanning = true;
      state.panStart = { x: e.clientX, y: e.clientY };
      state.centerStart = { cx: state.cx, cy: state.cy };
    });
    window.addEventListener('mouseup', () => { state.isPanning = false; });
    window.addEventListener('mousemove', (e) => {
      if(!state.isPanning) return;
      const dx = e.clientX - state.panStart.x;
      const dy = e.clientY - state.panStart.y;
      const dpr = window.devicePixelRatio || 1;
      state.cx = state.centerStart.cx - dx * (state.scale / dpr);
      state.cy = state.centerStart.cy - dy * (state.scale / dpr);
      stateToUi();
      renderMandelCore();
    });

    // Resize handling
    window.addEventListener('resize', () => renderMandelCore());

    // Initialize plots + Mandelbrot
    draw2D();
    draw3D();
    stateToUi();
    renderMandelCore();
    applyUrlParams();

    // Re-render Mandelbrot when inputs change
    ['cx','cy','scale','iter'].forEach(id => {
      document.getElementById(id).addEventListener('change', renderMandel);
      document.getElementById(id).addEventListener('input', (e)=>{ if(e.target.id==='iter') renderMandel(); });
    });
  </script>
</body>
</html>
